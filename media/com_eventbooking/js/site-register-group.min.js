!function(r,l,s){s(r).ready(function(){var e=window.location.hash.substr(1),t="";"group_billing"===(e=e||l.getOptions("defaultStep"))?(t=l.getOptions("groupBillingUrl"),s.ajax({url:t,dataType:"html",success:function(e){var t=s("#eb-group-billing .eb-form-content"),n=s("#email");t.html(e),t.slideDown("slow"),groupBillingFormLoaded(),n.val()&&n.validationEngine("validate")},error:function(e,t,n){alert(n+"\r\n"+e.statusText+"\r\n"+e.responseText)}})):"group_members"===e?(t=l.getOptions("groupMembersUrl"),s.ajax({url:t,dataType:"html",success:function(e){var t=s("#eb-group-members-information .eb-form-content");t.html(e),t.slideDown("slow"),groupMembersFormLoaded()},error:function(e,t,n){alert(n+"\r\n"+e.statusText+"\r\n"+e.responseText)}})):(t=l.getOptions("numberMembersUrl"),s.ajax({url:t,dataType:"html",success:function(e){var t=s("#eb-number-group-members .eb-form-content");t.html(e),t.slideDown("slow"),numberMembersFormLoaded()},error:function(e,t,n){alert(n+"\r\n"+e.statusText+"\r\n"+e.responseText)}}))}),numberMembersFormLoaded=function(){var n=s("#eb-form-number-group-members"),o=s("#btn-process-number-members");n.validationEngine(),o.click(function(){var e=n.validationEngine("validate"),t=l.getOptions("storeNumberMembersUrl");e&&s.ajax({url:t,dataType:"html",method:"post",data:{number_registrants:s('input[name="number_registrants"]').val()},beforeSend:function(){o.attr("disabled",!0),o.after('<span class="wait">&nbsp;<img src="'+l.getOptions("ajaxLoadingImageUrl")+'" alt="" /></span>')},complete:function(){o.attr("disabled",!1),s(".wait").remove()},success:function(e){if(s("#eb-number-group-members .eb-form-content").slideUp("slow"),l.getOptions("collectMemberInformation")){var t=s("#eb-group-members-information .eb-form-content");t.html(e),t.slideDown("slow"),groupMembersFormLoaded()}else{var n=s("#eb-group-billing .eb-form-content");n.html(e),n.slideDown("slow"),groupBillingFormLoaded()}},error:function(e,t,n){alert(n+"\r\n"+e.statusText+"\r\n"+e.responseText)}})})},populateMemberFormData=function(e,t){if(0!=t)for(var n=l.getOptions("memberFields",[]),o=n.length,a=[],r="",i=0;i<o;i++)s('input[name="'+n[i]+"_"+e+'[]"]').length?(a=s('input[name="'+n[i]+"_"+t+'[]"]:checked').map(function(){return s(this).val()}).get(),s('input[name="'+n[i]+"_"+e+'[]"]').val(a)):s('input[type="radio"][name="'+n[i]+"_"+e+'"]').length?(r=s('input[name="'+n[i]+"_"+t+'"]:checked').val(),s('input[name="'+n[i]+"_"+e+'"][value="'+r+'"]').attr("checked","checked")):(r=s("#"+n[i]+"_"+t).val(),s("#"+n[i]+"_"+e).val(r))},groupMembersFormLoaded=function(){var e=s("#eb-form-group-members"),t=s("#btn-group-members-back");e.validationEngine(),initCalendarFormFields("#eb-form-group-members .field-calendar");for(var n=s('#eb-form-group-members input[name="number_registrants"]').val(),o=0;o<n;o++)buildStateFields("state_"+o,"country_"+o,"");l.getOptions("showBillingStep")?s("#btn-process-group-members").click(btnProcessGroupMembersClickHandle):(initRecaptcha(),initializeTermsAndConditionsModal());if(t.click(btnBackGroupMembersClickHandle),Eb.jQuery().tooltip)e.find(".hasTooltip").tooltip({html:!0,container:"body"});else if(bootstrap.Tooltip){var a=r.getElementById("eb-form-group-members");[].slice.call(a.querySelectorAll(".hasTooltip")).map(function(e){return new bootstrap.Tooltip(e,{html:!0,container:"body"})})}EBMaskInputs(r.getElementById("eb-form-group-members"))},btnProcessGroupMembersClickHandle=function(){var e=s("#btn-process-group-members"),t=s("#eb-form-group-members");if(t.validationEngine("validate")){var n=l.getOptions("storeGroupMembersDataUrl");s.ajax({url:n,method:"post",data:t.serialize(),dataType:"json",beforeSend:function(){e.attr("disabled",!0),e.after('<span class="wait">&nbsp;<img src="'+l.getOptions("ajaxLoadingImageUrl")+'" alt="" /></span>'),s(".eb-field-validation-error").remove()},complete:function(){e.attr("disabled",!1),s(".wait").remove()},success:function(e){if("OK"==e.status){var t=s("#eb-group-billing .eb-form-content");s("ul.eb-validation_errors").remove(),s("#eb-group-members-information .eb-form-content").slideUp("slow"),t.html(e.html),t.slideDown("slow"),groupBillingFormLoaded()}else{for(var n in e.errors)value=e.errors[n],s('<div class="eb-field-validation-error required"> '+value+"</div>").insertAfter("#"+n);s("#eb-group-members-information .eb-form-content").prepend(e.html)}},error:function(e,t,n){alert(n+"\r\n"+e.statusText+"\r\n"+e.responseText)}})}},btnBackGroupMembersClickHandle=function(){var e=s("#btn-group-members-back"),t=l.getOptions("numberMembersUrl");s.ajax({url:t,method:"post",dataType:"html",beforeSend:function(){e.attr("disabled",!0)},complete:function(){e.attr("disabled",!1)},success:function(e){s("#eb-group-members-information .eb-form-content").slideUp("slow");var t=s("#eb-number-group-members .eb-form-content");t.html(e),t.slideDown("slow"),numberMembersFormLoaded()},error:function(e,t,n){alert(n+"\r\n"+e.statusText+"\r\n"+e.responseText)}})},groupBillingFormLoaded=function(){s("#eb-login-form").validationEngine(),initCalendarFormFields("#adminForm .field-calendar"),buildStateFields("state","country",s("#group_billing_selected_state").val()),s("#adminForm").validationEngine("attach",{onValidationComplete:groupRegistrationValidationComplete});var e=s("#email"),t=s("#group_billing_payment_amount").val();if(e.val()&&e.validationEngine("validate"),l.getOptions("squareUpEnabled")&&!l.getOptions("waitingList")&&sqPaymentForm.build(),0===parseFloat(t)&&s(".payment_information").css("display","none"),createStripeCardElement(),l.getOptions("squareAppId")&&createSquareCardElement(),EBMaskInputs(r.getElementById("adminForm")),initRecaptcha(),s("#btn-group-billing-back").click(btnGroupBillingBackClickHandle),initializeTermsAndConditionsModal(),l.getOptions("collectMemberInformation")&&s("html, body").animate({scrollTop:s("#eb-group-members-information").position().top},"slow"),l.getOptions("isCountryBaseTax")&&s("#country").on("change",calculateGroupRegistrationFee),l.getOptions("isEUTaxRuleEnabled")){var n=l.getOptions("euVatNumberField"),o=s("#"+n);o.after('<span class="invalid" id="vatnumber_validate_msg" style="display: none;">'+l.JText._("EB_INVALID_VATNUMBER")+"</span></div>"),o.change(calculateGroupRegistrationFee),"1"===s("#group_billing_show_vat_number_field").val()?s("#field_"+n).show():s("#field_"+n).hide()}if(s("#return_url").val(l.getOptions("returnUrl")),Eb.jQuery().tooltip)s("#adminForm").find(".hasTooltip").tooltip({html:!0,container:"body"});else if(bootstrap.Tooltip){var a=r.getElementById("adminForm");[].slice.call(a.querySelectorAll(".hasTooltip")).map(function(e){return new bootstrap.Tooltip(e,{html:!0,container:"body"})})}},btnGroupBillingBackClickHandle=function(){var e=l.getOptions("storeGroupBillingDataUrl"),t=s("#btn-group-billing-back");s.ajax({url:e,method:"post",data:s("#adminForm").serialize(),dataType:"html",beforeSend:function(){t.attr("disabled",!0)},complete:function(){t.attr("disabled",!1)},success:function(e){var t=s("#eb-group-members-information .eb-form-content");t.html(e),s("#eb-group-billing .eb-form-content").slideUp("slow"),l.getOptions("collectMemberInformation")?(t.slideDown("slow"),groupMembersFormLoaded()):(s("#eb-number-group-members .eb-form-content").slideDown("slow"),numberMembersFormLoaded())},error:function(e,t,n){alert(n+"\r\n"+e.statusText+"\r\n"+e.responseText)}})},groupRegistrationValidationComplete=function(e,t){return!0===t&&(e.on("submit",function(e){e.preventDefault()}),e.find("#btn-process-group-billing").prop("disabled",!0),paymentMethodCallbackHandle())},initRecaptcha=function(){var e=l.getOptions("showCaptcha"),t=l.getOptions("captchaPlugin");e&&"recaptcha"===t?EBInitReCaptcha2():e&&"recaptcha_invisible"===t&&EBInitReCaptchaInvisible()},initCalendarFormFields=function(e){var t=r.querySelectorAll(e);for(i=0;i<t.length;i++)JoomlaCalendar.init(t[i])},calculateGroupRegistrationFee=function(){var t=s("#btn-process-group-billing"),n=s("#ajax-loading-animation"),o=s("#total_amount"),a=s("#amount");t.attr("disabled","disabled"),n.show();var r=l.getOptions("euVatNumberField"),e='#adminForm input[name="event_id"], #adminForm input[name="coupon_code"], #adminForm .payment-calculation input[type="text"], #adminForm .payment-calculation input[type="number"], #adminForm .payment-calculation input[type="checkbox"]:checked, #adminForm .payment-calculation input[type="radio"]:checked, #adminForm .payment-calculation select, #adminForm input.eb-hidden-field:hidden, #adminForm select[name="country"], #adminForm select[name="state"]';r&&(e=e+', #adminForm input[name="'+r+'"]'),s("input:radio[name^=payment_method]").length?e+=", input:radio[name^=payment_method]:checked":e+=", input[name^=payment_method]";var i=l.getOptions("calculateGroupRegistrationFeeUrl");s.ajax({type:"POST",url:i,data:s(e),dataType:"json",success:function(e){t.removeAttr("disabled"),n.hide(),o.val(e.total_amount),s("#discount_amount").val(e.discount_amount),s("#tax_amount").val(e.tax_amount),s("#payment_processing_fee").val(e.payment_processing_fee),a.val(e.amount),s("#deposit_amount").val(e.deposit_amount),(a.length||o.length)&&0==e.payment_amount?s(".payment_information").css("display","none"):(s(".payment_information").css("display",""),updatePaymentMethod()),1==e.coupon_valid?s("#coupon_validate_msg").hide():(t.attr("disabled","disabled"),s("#coupon_validate_msg").show()),1==s("#payment_type").val()?s("#deposit_amount_container").show():s("#deposit_amount_container").hide(),r&&(1==e.show_vat_number_field?s("#field_"+r).show():s("#field_"+r).hide(),1==e.vat_number_valid?s("#vatnumber_validate_msg").hide():s("#vatnumber_validate_msg").show())},error:function(e,t){alert(t)}})}}(document,Joomla,Eb.jQuery);